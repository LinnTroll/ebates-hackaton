!function(e,t,a){var s;window.optimizely=window.optimizely||[],ebates=ebates||{},ebates.cookie={set:function(e,a,s){var i=new Date;i.setTime(i.getTime()+864e5*s),t.cookie=e+"="+a+";expires="+i.toUTCString()+";path=/;"},get:function(e){var a=t.cookie.split(e+"=");return 2===a.length&&a.pop().split(";").shift()}},ebates.GA=ebates.GA||{},ebates.stats=ebates.stats||{},ebates.GA.opts={cookieDomain:location.hostname,forceSSL:!0,useAmpClientId:!0},ebates.GA.id="www.ebates.com"===location.hostname||"preview.ebates.com"===location.hostname||"stage.rakuten.com"===location.hostname||"www.rakuten.com"===location.hostname?"UA-1707619-3":"UA-1707619-8",ebates.user=ebates.user||{},ebates.user.guid&&(ebates.GA.opts.userId=ebates.user.guid),ebates.user.membership=ebates.user.status&&/^REGISTERED/.test(ebates.user.status)?"member":"non-member",function(e,t,a,s,i,n,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=+new Date,n=t.createElement(a),o=t.getElementsByTagName(a)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(n,o)}(window,t,"script",0,"ga"),ga(function(){ebates.GA.ready=!0}),ga("create",ebates.GA.id,ebates.GA.opts),ga("require","linkid","linkid.js"),ebates.user.status&&ga("set",{dimension1:ebates.user.status,dimension2:ebates.user.membership}),ebates.session&&ebates.session.id&&ga("set",{dimension3:ebates.session.id}),ebates.user.rsid&&ga("set",{dimension31:ebates.user.rsid}),ebates.user.guid&&ga("set",{dimension13:ebates.user.guid}),ebates.user.lifecycleStage&&ga("set",{dimension26:ebates.user.lifecycleStage}),ebates.user.id_last_digit&&ga("set",{dimension37:ebates.user.id_last_digit}),s=ebates.cookie.get("ESID"),s&&ga("set",{dimension36:s}),ga("send","pageview"),ebates.stats.send=function(t,a){var s,i,n,o,r=e.noop,d={send:{event:"y",pageview:"y"}};!0!==window.ebates.deferStats&&(a&&e.isArray(a.data)&&a.data.length>1?(s=a.data[a.data.length-1],o=function(){ebates.pathInMap(d,[a.data[0],a.data[1]])&&ga(function(){ga.apply(null,a.data)}),!ebates.GA.ready&&r()},i="object"==typeof s&&"function"==typeof s.hitCallback&&s.hitCallback,i?(n=setTimeout(i,ebates.stats.timeout),r=function(){clearTimeout(n),i()},a.data[a.data.length-1]={hitCallback:r},e.when.apply(e,ebates.stats.webAnalytics(a)).then(o,o)):(ebates.stats.webAnalytics(a),o())):a.map&&ebates.stats.webAnalytics(a))},ebates.stats.webAnalytics=function(t){var a,i,n,o,r=[],d={pageview:{"/address-guidedhelp-bigfatpayment-view":"Address - Guided Help: Big Fat Payment - View","/address-guidedhelp-bigfatpayment-click":"Address - Guided Help: Big Fat Payment - Click","/address-guidedhelp-bigfatpayment-complete":"Address - Guided Help: Big Fat Payment - Complete"},event:{"Shopping Trip":{"ABP detected":"Merchant Session - AdBlock Plus enabled"},Video:{"In-Store Cash Back":"Video - In-Store Cash Back",Welcome:{CBMS:"Video - Cash Back Made Simple"}},Overlays:{"Address - Address Overlay - Click":"Address - Address Overlay - Click","Address - Address Overlay - Complete":"Address - Address Overlay - Complete","Address - Address Overlay - View":"Address - Address Overlay - View","How to earn cash back":"How to Earn Cash Back Overlay"},Cashstar:{"cashstar-changed-mind":"Cashstar - Changed Mind","cashstar-get-card":"Cashstar - Get Card","cashstar-sign-in":"Cashstar - Sign-In"},"/merchant-store-page-visit":"Merchant Store Page Visit","/captcha":"Captcha","/create-password-failure":"Create Password - Failure","/change-password-request-failure":"Change Password - Request Failure","/password-force-reset-failure":"Password Force Reset - Failure","/change-password-display":"Change Password - Display","/change-password-request":"Change Password - Request",Pages:{Welcome:"View - Ebates Welcome page",Luxe:{Landing:"View - Ebates Luxury page","All Stores":"View - Ebates Luxury All Stores page"},HP:{Video:"View - Ebates test homepage"}}}};if(t.map&&t.map.optimizely&&(t.map.optimizely.tags?window.optimizely.push(t.map.optimizely):window.optimizely.push(["trackEvent",t.map.optimizely])),t.data&&(n=ebates.pathInMap(d,t.data.slice(1))),n=n||t.map&&t.map.internal,void 0!==n&&n&&(i=t.entities?t.entities:[{entityType:n,instanceId:"userId"}],a={eventType:n,entities:i},r.push(e.ajax({url:"/frontendEvents.do",data:JSON.stringify(a),type:"POST",contentType:"application/json"}))),t.map&&t.map.external&&ebates.stats.externalUrl){if(o={uid:"",guid:ebates.user.guid,sid:ebates.session.id,rsid:ebates.user.rsid,ts:Date.now()-ebates.stats.timeDelta,url:location.href,dt:ebates.stats.device},s&&(o.esid=s),ebates.user.status&&(o.us=ebates.user.status),"function"==typeof navigator.sendBeacon&&ebates.stats.unload&&(!/(iPad|iPhone|iPod)/.test(navigator.userAgent)||/(CriOS|FxiOS)/g.test(navigator.userAgent)))return navigator.sendBeacon(ebates.stats.externalUrl,JSON.stringify(e.extend(o,t.map.external))),r;r.push(e.ajax({url:ebates.stats.externalUrl,data:JSON.stringify(e.extend(o,t.map.external)),type:"POST",contentType:"text/plain",timeout:2*ebates.stats.timeout}))}return r},ebates.stats.global=function(){var t=e("body"),s=["SignIn","SignUp"],i={"Forgot Click":".tablet-overlay .forgotOverlay","Signin Click":".tablet-overlay .show-join-overlay.loginIe8","Signup Click":".tablet-overlay .show-join-overlay.joinIe8"},n=function(t){var s=e(this).closest(".tablet-overlay").find("input[name='type']");a.trigger("stats",{data:["send","event","Overlays",t.data.action,s.val&&s.val()||"other"]})};e.each(i,function(e,a){t.on("click",a,{action:e},n)}),e.each(s,function(e,t){var i=ebates.cookie.get(t),n=i&&i.split("|")||[];i&&t===s[1]&&n.length>1&&ebates.cookie.set("opt-signup",i),n.length>1&&a.trigger("stats",{data:["send","event",t,n[0],n[1].replace(/_/g," "),{hitCallback:function(){ebates.cookie.set(t,0,-1)}}]})})},ebates.stats.trackNavIds=function(e,t){var a,s,i,n=t;n?ebates.cookie.set("navigation_id",n):this.getAttribute&&(a=this.getAttribute("data-navigation-id"),s=this.getAttribute("href"),i=s&&-1!==s.indexOf("-xfas"),n=i?ebates.stats.parentNavId+"|"+a:a,ebates.cookie.set("navigation_id",n))},ebates.stats.trackClick={queue:{},unload:function(){var t=function(e){ebates.stats.send(null,ebates.stats.trackClick.queue[e])};ebates.stats.unload=!0,e.ajaxSetup({async:!1}),Object.keys(ebates.stats.trackClick.queue).map(t)},send:function(e,t,a){var s="double-tracking-off-"+a,i={key:+Date.now(),send:function(){ebates.stats.send(null,t),delete ebates.stats.trackClick.queue[i.key],e.classList.remove(s)}};t&&!e.classList.contains(s)&&(e.classList.add(s),ebates.stats.trackClick.queue[i.key]=t,setTimeout(i.send,ebates.stats.timeout/2))},ga:function(){var e={category:this.getAttribute("data-click-category")};e.action=this.getAttribute("data-click-action"),e.action&&(e.data=["send","event",e.category,e.action],e.label=this.getAttribute("data-click-label"),e.label&&e.data.push(e.label),ebates.stats.trackClick.send(this,{data:e.data},"ga"))},external:function(){var e=this,t=e.getAttribute("data-event-signature").split(","),a={};t.length&&(t.map(function(t){var s=e.getAttribute("data-"+t);null!==s&&(a[t]=s)}),ebates.stats.trackClick.send(this,{map:{external:a}},"ext"))}},ebates.pathInMap=function(e,t){return e&&"string"!=typeof e?ebates.pathInMap(e[t.shift()],t):e},a.on("stats",ebates.stats.send),window.addEventListener("error",function(e){var t,s,i,n,o={};e.message&&e.filename&&(t=300,o.host=new RegExp(window.location.protocol+"//"+window.location.host,"gi"),o.file=new RegExp(e.filename,"gi"),i=e.message.substring(0,t),i+=i.length===t?"...":"",n=e.error&&e.error.stack?e.error.stack.replace(/\s+/gi," ").replace(o.file,"FILE").replace(e.message,"ERR"):"",s=(e.filename+":"+(e.lineno||"")+":"+(e.colno||"")+"|"+n).replace(o.host,""),s+=s.length===t?"...":"",a.trigger("stats",{data:["send","event","JS",i,s]}))},!1),e(function(){ebates.stats.global(),a.on("click","a[data-navigation-id]",ebates.stats.trackNavIds).on("set-nav-id",ebates.stats.trackNavIds).on("contextmenu webkitmouseforcewillbegin","a[data-navigation-id]",function(){ebates.stats.trackNavIds.call(this),setTimeout(e.proxy(ebates.cookie.set,ebates.cookie,"navigation_id",0,-1),10*ebates.stats.timeout)}).on("click","[data-click-category]",ebates.stats.trackClick.ga).on("click","[data-event-signature]",ebates.stats.trackClick.external),window.addEventListener("unload",ebates.stats.trackClick.unload,!1),window.addEventListener("load",function(){var e=["cookie_id","euid","eutid"],t=ebates.stats.cookieSyncUrl,a=new Image;void 0===ebates.param||/rakuten\.com/.test(location.hostname)||(e.map(function(e){var a=ebates.cookie.get(e)||"";t=ebates.param.add(e,a,t)}),a.src=t)})});try{if(window.localStorage.getItem("pending-events")){var i=JSON.parse(window.localStorage.getItem("pending-events"));i.length>0&&(i.forEach(function(e,t,a){setTimeout(function(){ebates.stats.send(null,e)},100)}),window.localStorage.removeItem("pending-events"))}}catch(e){}if(window.localStorage.getItem("social_su_si")&&ebates.param.get("social_media")){var n=ebates.optim&&ebates.optim.get_custom_su_event&&ebates.optim.get_custom_su_event()||"tracking-error",o={data:[],map:{external:{ec:"Signup Form",ea:"Sign In Success",el:n},optimizely:{type:"event",eventName:"Signup Form",tags:{event_category:"Signup Form",event_action:"Sign In Success",event_label:n}}}};setTimeout(function(){ebates.stats.send(null,o)},100)}}($,document,$(document));
//# sourceMappingURL=stats-05fe15840a.js.map
